<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Automatic and Manual Return of the Timings • rcpptimer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Automatic and Manual Return of the Timings">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rcpptimer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/rcpptimer.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/advanced.html">Advanced Usage of rcpptimer</a></li>
    <li><a class="dropdown-item" href="../articles/autoreturn.html">Automatic and Manual Return of the Timings</a></li>
    <li><a class="dropdown-item" href="../articles/packages.html">Adding rcpptimer to a Package</a></li>
    <li><a class="dropdown-item" href="../articles/sourceCpp.html">Using rcpptimer with Rcpp::sourceCpp</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BerriJ/rcpptimer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Automatic and Manual Return of the Timings</h1>
                        <h4 data-toc-skip class="author">Jonathan
Berrisch</h4>
            
            <h4 data-toc-skip class="date">2024-09-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/BerriJ/rcpptimer/blob/main/vignettes/autoreturn.Rmd" class="external-link"><code>vignettes/autoreturn.Rmd</code></a></small>
      <div class="d-none name"><code>autoreturn.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="assign-a-custom-name-to-the-timings-object">Assign a Custom Name to the Timings Object<a class="anchor" aria-label="anchor" href="#assign-a-custom-name-to-the-timings-object"></a>
</h2>
<p>If you want to give the dataframe a different name, you can pass that
name to the constructor:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html" class="external-link">cppFunction</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">double demo_rnorm()</span></span>
<span><span class="st">{</span></span>
<span><span class="st"> Rcpp::Timer timer("mytimes");</span></span>
<span><span class="st"> timer.tic();</span></span>
<span><span class="st"> double x = rnorm(1, 1)[0];</span></span>
<span><span class="st"> timer.toc();</span></span>
<span><span class="st"> return(x);</span></span>
<span><span class="st">}'</span>,</span>
<span>  depends <span class="op">=</span> <span class="st">"rcpptimer"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">demo_rnorm</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -0.4000435</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mytimes</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        Microseconds SD    Min    Max Count</span></span>
<span><span class="co">## tictoc       13.966  0 13.966 13.966     1</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="manually-handling-the-results">Manually Handling the Results<a class="anchor" aria-label="anchor" href="#manually-handling-the-results"></a>
</h2>
<p>You may need to handle the resulting DataFrame yourself instead of
letting <code>rcpptimer</code> write it to the global environment.</p>
<p>This issue consists of two elements:</p>
<ul>
<li>Turn off the <code>autoreturn</code> feature</li>
<li>Handle the results yourself</li>
</ul>
<p>First, to turn off <code>autoreturn</code>, set the
<code>autoreturn</code> variable of your <code>Timer</code> instance to
<code>false</code>. That will prevent the <code>timer</code> from
writing the results to the global environment.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html" class="external-link">cppFunction</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">double demo_rnorm()</span></span>
<span><span class="st">{</span></span>
<span><span class="st"> Rcpp::Timer timer;</span></span>
<span><span class="st"> timer.autoreturn = false;</span></span>
<span><span class="st"> timer.tic("rnorm");</span></span>
<span><span class="st"> double x = rnorm(1, 1)[0];</span></span>
<span><span class="st"> timer.toc("rnorm");</span></span>
<span><span class="st"> return(x);</span></span>
<span><span class="st">}'</span>,</span>
<span>  depends <span class="op">=</span> <span class="st">"rcpptimer"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">demo_rnorm</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1.255317</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "demo_rnorm"</span></span></code></pre>
<p>Now, <code>mem</code> will not write to the global environment.
However, you can still access the results through the timer’s
<code>.stop()</code> method:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html" class="external-link">cppFunction</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">DataFrame demo_rnorm()</span></span>
<span><span class="st">{</span></span>
<span><span class="st"> Rcpp::Timer timer;</span></span>
<span><span class="st"> timer.autoreturn = false;</span></span>
<span><span class="st"> timer.tic("rnorm");</span></span>
<span><span class="st"> double x = rnorm(1, 1)[0];</span></span>
<span><span class="st"> timer.toc("rnorm");</span></span>
<span><span class="st"> DataFrame times = timer.stop();</span></span>
<span><span class="st"> return(times);</span></span>
<span><span class="st">}'</span>,</span>
<span>  depends <span class="op">=</span> <span class="st">"rcpptimer"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">demo_rnorm</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       Microseconds SD   Min   Max Count</span></span>
<span><span class="co">## rnorm        6.312  0 6.312 6.312     1</span></span></code></pre>
<p>It is also possible to use <code>.stop()</code> <em>and</em> let
rcpptimer pass the results automatically. In the above example, just set
<code>autoreturn</code> to true (the default) or delete that line.</p>
<p>You can find instructions in <code><a href="../articles/advanced.html">vignette("advanced")</a></code> if you
want to access the raw timings data.</p>
</div>
<div class="section level2">
<h2 id="considerations-for-package-authors">Considerations for package authors<a class="anchor" aria-label="anchor" href="#considerations-for-package-authors"></a>
</h2>
<p>As a package author, you should parameterize the auto-return feature
so your users can decide whether they want the results to be passed to
the global environment and what name should be assigned. Below is an
example of how to do this.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">Rcpp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html" class="external-link">cppFunction</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">double demo_rnorm(bool return_timings = false,</span></span>
<span><span class="st"> const char* timings_name = "times")</span></span>
<span><span class="st">{</span></span>
<span><span class="st"> Rcpp::Timer timer(timings_name);</span></span>
<span><span class="st"> timer.autoreturn = return_timings;</span></span>
<span><span class="st"> timer.tic("rnorm");</span></span>
<span><span class="st"> double x = rnorm(1, 1)[0];</span></span>
<span><span class="st"> timer.toc("rnorm");</span></span>
<span><span class="st"> return(x);</span></span>
<span><span class="st">}'</span>,</span>
<span>  depends <span class="op">=</span> <span class="st">"rcpptimer"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">demo_rnorm</span><span class="op">(</span>return_timings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.9944287</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "demo_rnorm"</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">demo_rnorm</span><span class="op">(</span>return_timings <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1.621553</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "demo_rnorm" "times"</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">demo_rnorm</span><span class="op">(</span>return_timings <span class="op">=</span> <span class="cn">TRUE</span>, timings_name <span class="op">=</span> <span class="st">"my_times"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2.148412</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "demo_rnorm" "my_times"   "times"</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.berrisch.biz/" class="external-link">Jonathan Berrisch</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
