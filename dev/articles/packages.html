<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Adding rcpptimer to a Package • rcpptimer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Adding rcpptimer to a Package">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rcpptimer</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/rcpptimer.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/advanced.html">Advanced Usage of rcpptimer</a></li>
    <li><a class="dropdown-item" href="../articles/autoreturn.html">Automatic and Manual Return of the Timings</a></li>
    <li><a class="dropdown-item" href="../articles/packages.html">Adding rcpptimer to a Package</a></li>
    <li><a class="dropdown-item" href="../articles/sourceCpp.html">Using rcpptimer with Rcpp::sourceCpp</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BerriJ/rcpptimer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Adding rcpptimer to a Package</h1>
                        <h4 data-toc-skip class="author">Jonathan
Berrisch</h4>
            
            <h4 data-toc-skip class="date">2024-09-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/BerriJ/rcpptimer/blob/dev/vignettes/packages.Rmd" class="external-link"><code>vignettes/packages.Rmd</code></a></small>
      <div class="d-none name"><code>packages.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="adding-rcpptimer-to-your-package">Adding rcpptimer to your Package<a class="anchor" aria-label="anchor" href="#adding-rcpptimer-to-your-package"></a>
</h2>
<p>Using rcpptimer in your package is simple. Just link to it in your
<code>DESCRIPTION</code> file:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>LinkingTo<span class="sc">:</span> <span class="fu">rcpptimer</span> (<span class="sc">&gt;=</span> <span class="dv">1</span>.<span class="fl">2.0</span>)</span></code></pre></div>
<p>And add the header into your .cpp file
<code>#include &lt;rcpptimer.h&gt;</code>. Now, you can create and use
an instance of the <code>Rcpp::Timer</code> class. Consider this
<code>fibonacci_omp</code> function:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;rcpptimer.h&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="dt">long</span> <span class="dt">int</span> fib<span class="op">(</span><span class="dt">long</span> <span class="dt">int</span> n<span class="op">)</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">((</span>n <span class="op">&lt;=</span> <span class="dv">1</span><span class="op">)</span> <span class="op">?</span> n <span class="op">:</span> fib<span class="op">(</span>n <span class="op">-</span> <span class="dv">1</span><span class="op">)</span> <span class="op">+</span> fib<span class="op">(</span>n <span class="op">-</span> <span class="dv">2</span><span class="op">));</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">//[[Rcpp::export]]</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">long</span> <span class="dt">int</span><span class="op">&gt;</span> fibonacci_omp<span class="op">(</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">long</span> <span class="dt">int</span><span class="op">&gt;</span> n<span class="op">)</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>  Rcpp<span class="op">::</span>Timer timer<span class="op">;</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a> <span class="co">// This scoped timer measures the total execution time of 'fibonacci'</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>  Rcpp<span class="op">::</span>Timer<span class="op">::</span>ScopedTimer scpdtmr<span class="op">(</span>timer<span class="op">,</span> <span class="st">"fib_body"</span><span class="op">);</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>  <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">long</span> <span class="dt">int</span><span class="op">&gt;</span> results <span class="op">=</span> n<span class="op">;</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>  <span class="pp">#pragma omp parallel for</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">.</span>size<span class="op">();</span> <span class="op">++</span>i<span class="op">)</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>    timer<span class="op">.</span>tic<span class="op">(</span><span class="st">"fib_"</span> <span class="op">+</span> <span class="bu">std::</span>to_string<span class="op">(</span>n<span class="op">[</span>i<span class="op">]));</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>    results<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> fib<span class="op">(</span>n<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>    timer<span class="op">.</span>toc<span class="op">(</span><span class="st">"fib_"</span> <span class="op">+</span> <span class="bu">std::</span>to_string<span class="op">(</span>n<span class="op">[</span>i<span class="op">]));</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">(</span>results<span class="op">);</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>This function is available in rcpptimer so you can try it yourself,
e.g., <code>rcpptimer::fibonacci(n = rep(20:25, 10))</code>. After that,
you can inspect the timings by executing <code>print(times)</code>.</p>
<p>As you can see, it writes the timings to the global environment as
data.frame called <code>times</code>. Read the following section to
learn why this differs from what you want in a package.</p>
</div>
<div class="section level2">
<h2 id="autoreturn">Autoreturn<a class="anchor" aria-label="anchor" href="#autoreturn"></a>
</h2>
<p>When using rcpptimer in your package, consider turning off the
timer’s <code>autoreturn</code> feature. Users of your package may need
to be made aware of this functionality. They may already have an object
named <code>times</code> in their global environment or may have
rigorous expectations about what objects they want to write into their
environment. Instead, you should include the timings in your data
structures or parameterize the name of the returned object, the
<code>autoreturn</code> feature itself, or both.</p>
<p>See <code><a href="../articles/autoreturn.html">vignette("autoreturn")</a></code> vignette to read about this
in detail.</p>
</div>
<div class="section level2">
<h2 id="reexport-print-method">Reexport Print Method<a class="anchor" aria-label="anchor" href="#reexport-print-method"></a>
</h2>
<p>If you use <code>rcpptimer</code> in your package, you may want to
suggest <code>rcpptimer</code> in your DESCRIPTION and register the S3
method <code>print.rcpptimer</code>. This method is used to print the
timings in a more readable way. It will scale the results to be more
readable. I.e. if all timings are greater than 1 second, it will print
the results in seconds.</p>
<p>Two adjustments are necessary in your package:</p>
<p>First, add the following line to your <code>DESCRIPTION</code>
file:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>Suggests<span class="sc">:</span> <span class="fu">rcpptimer</span> (<span class="sc">&gt;=</span> <span class="dv">1</span>.<span class="fl">2.0</span>)</span></code></pre></div>
<p>Second, add the following code to your package:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"rcpptimer"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ns-internal.html" class="external-link">registerS3method</a></span><span class="op">(</span><span class="st">"print"</span>, <span class="st">"rcpptimer"</span>, <span class="fu">rcpptimer</span><span class="fu">:::</span><span class="va"><a href="../reference/print.rcpptimer.html">print.rcpptimer</a></span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This will register <code>print.rcpptimer</code> if
<code>rcpptimer</code> is available. You can place this code in a
function that uses <code>rcpptimer</code> or your package’s
<code>.onLoad</code> function<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://r-pkgs.org/code.html#sec-code-onLoad-onAttach" class="external-link uri"&gt;https://r-pkgs.org/code.html#sec-code-onLoad-onAttach&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a>.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.berrisch.biz/" class="external-link">Jonathan Berrisch</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
