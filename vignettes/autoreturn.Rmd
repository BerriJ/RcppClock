---
title: "Automatic and Manual Return of the Timings"
author: Jonathan Berrisch
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    number_sections: no
    toc: no
vignette: >
  %\VignetteIndexEntry{Automatic and Manual Return of the Timings}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Assign a Custom Name to the Timings Object

If you want to give the dataframe a different name, you can pass that name to the constructor:

```{r, eval = TRUE}
Rcpp::cppFunction('
int mem()
{
  Rcpp::Timer timer("mytimes");
  timer.tic();
  std::string s;
  s.reserve(1048576);
  timer.toc();
  return(0);
}',
  depends = "rcpptimer"
)

mem()

print(mytimes)
```

```{r, eval = TRUE, echo = FALSE}
rm(list = ls())
```

## Manually Handling the Results

You may need to handle the resulting DataFrame yourself instead of letting `rcpptimer` write it to the global environment. 

This issue actually consists of two elements:

- Turn off the autoreturn feature
- Handle the results yourself

First, to turn off the autoreturn feature, set the `autoreturn` variable of the `timer` class to `false`. That will prevent the `timer` from writing the results to the global environment. 

```{r, eval = TRUE}
Rcpp::cppFunction('
int mem()
{
  Rcpp::Timer timer;
  timer.autoreturn = false;
  timer.tic("mem");
  std::string s;
  s.reserve(1048576);
  timer.toc("mem");
  return(0);
}',
  depends = "rcpptimer"
)

mem()

print(ls())
```

Now, `mem` will not write to the global environment. However, you can still access the results through the timer's `.stop()` method:

```{r, eval = TRUE}
Rcpp::cppFunction('
DataFrame mem()
{
  Rcpp::Timer timer;
  timer.autoreturn = false;
  timer.tic("mem");
  std::string s;
  s.reserve(1048576);
  timer.toc("mem");
  DataFrame times = timer.stop();
  return(times);
}',
  depends = "rcpptimer"
)

mem()
```

It is also possible to use `.stop()` *and* let rcpptimer pass the results automatically. In the above example, we just set autoreturn to true (the default) or delete that line. 

## Considerations for package authors

```{r, eval = TRUE, echo = FALSE}
rm(list = ls())
```

As a package author, you should parameterize the auto-return feature so your users can decide whether they want the results to be passed to the global environment and what name should be assigned. Below is an example of how to do this.

```{r, eval = TRUE}
Rcpp::cppFunction('
void mem(bool return_timings = false,
         const char* timings_name = "times")
{
  Rcpp::Timer timer(timings_name);
  timer.autoreturn = return_timings;
  timer.tic("mem");
  std::string s;
  s.reserve(1048576);
  timer.toc("mem");
}',
  depends = "rcpptimer"
)

mem(return_timings = FALSE)
ls()
mem(return_timings = TRUE)
ls()
mem(return_timings = TRUE, timings_name = "my_times")
ls()
```
